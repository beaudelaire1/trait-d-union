<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Devis {{ quote.number }}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&display=swap');
        
        :root {
            --tus-black: #07080A;
            --tus-white: #F6F7FB;
            --tus-blue: #0B2DFF;
            --tus-green: #22C55E;
            --tus-green-light: #4ADE80;
            --tus-gray: #6B7280;
            --tus-gray-dark: #374151;
            --tus-light: #E5E7EB;
        }
        
        @page {
            size: A4;
            margin: 0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 9pt;
            line-height: 1.4;
            color: var(--tus-black);
            background: white;
        }
        
        .page {
            width: 210mm;
            height: 297mm;
            position: relative;
            padding-bottom: 32mm;
            overflow: hidden;
        }
        
        /* === HEADER === */
        .header {
            background: linear-gradient(135deg, var(--tus-black) 0%, #1a1d23 100%);
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .brand-logo {
            display: flex;
            align-items: center;
        }
        
        .brand-logo svg {
            height: 36px;
            width: auto;
        }
        
        .doc-header { text-align: right; }
        
        .doc-type {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 22pt;
            font-weight: 700;
            color: white;
            letter-spacing: -1px;
        }
        
        .doc-number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 11pt;
            font-weight: 600;
            color: var(--tus-green);
        }
        
        /* === META SECTION === */
        .meta-section {
            background: var(--tus-white);
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--tus-green);
        }
        
        .meta-info {
            display: flex;
            gap: 25px;
            font-size: 8pt;
        }
        
        .meta-item .label {
            font-size: 6pt;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--tus-gray);
        }
        
        .meta-item strong {
            display: block;
            color: var(--tus-black);
            font-weight: 600;
            font-size: 9pt;
        }
        
        .total-badge {
            background: linear-gradient(135deg, var(--tus-green) 0%, var(--tus-green-light) 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .total-badge .label {
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
        }
        
        .total-badge .amount {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 16pt;
            font-weight: 700;
        }
        
        /* === PARTIES === */
        .parties {
            display: flex;
            gap: 15px;
            padding: 15px 30px;
        }
        
        .party {
            flex: 1;
            border-radius: 8px;
            padding: 12px 15px;
        }
        
        .party.emitter {
            background: var(--tus-white);
            border: 1px solid var(--tus-light);
            border-left: 3px solid var(--tus-blue);
        }
        
        .party.client {
            background: white;
            border: 1px solid var(--tus-green);
            border-left: 3px solid var(--tus-green);
        }
        
        .party-label {
            font-size: 6pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 6px;
        }
        
        .party.emitter .party-label { color: var(--tus-blue); }
        .party.client .party-label { color: var(--tus-green); }
        
        .party-name {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 11pt;
            font-weight: 700;
            color: var(--tus-black);
            margin-bottom: 2px;
        }
        
        .party-tagline {
            font-size: 7pt;
            font-style: italic;
            color: var(--tus-gray);
            margin-bottom: 6px;
        }
        
        .party-details {
            font-size: 8pt;
            line-height: 1.5;
            color: var(--tus-gray-dark);
        }
        
        /* === ITEMS TABLE === */
        .items-section {
            padding: 10px 30px;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 8pt;
            border: 1px solid var(--tus-gray);
        }
        
        .items-table thead th {
            background: var(--tus-black);
            color: white;
            font-size: 7pt;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 10px 8px;
            text-align: left;
            border: 1px solid var(--tus-gray);
        }
        
        .items-table thead th:last-child { text-align: right; }
        .items-table thead th.center { text-align: center; }
        .items-table thead th.right { text-align: right; }
        
        .items-table tbody td {
            padding: 10px 8px;
            border: 1px solid var(--tus-light);
            vertical-align: top;
        }
        
        .items-table tbody tr:last-child td {
            border-bottom: 2px solid var(--tus-green);
        }
        
        .items-table tbody td.center { text-align: center; }
        .items-table tbody td.right { text-align: right; }
        
        .item-description {
            font-weight: 600;
            color: var(--tus-black);
        }
        
        .item-detail {
            font-size: 7pt;
            color: var(--tus-gray);
            margin-top: 2px;
        }
        
        .amount-cell {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
        }
        
        /* === TOTALS === */
        .totals-section {
            padding: 10px 30px;
            display: flex;
            justify-content: flex-end;
        }
        
        .totals-box {
            width: 220px;
            background: var(--tus-white);
            border-radius: 8px;
            padding: 12px;
        }
        
        .totals-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 9pt;
        }
        
        .totals-row .label { color: var(--tus-gray); }
        
        .totals-row .value {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            color: var(--tus-black);
        }
        
        .totals-row.subtotal {
            border-bottom: 1px dashed var(--tus-light);
            padding-bottom: 8px;
            margin-bottom: 4px;
        }
        
        .totals-row.grand-total {
            background: linear-gradient(135deg, var(--tus-green) 0%, var(--tus-green-light) 100%);
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            margin-top: 8px;
        }
        
        .totals-row.grand-total .label {
            color: rgba(255,255,255,0.9);
            font-weight: 600;
        }
        
        .totals-row.grand-total .value {
            font-size: 14pt;
            color: white;
        }
        
        .totals-row.amount-words {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--tus-light);
            flex-direction: column;
            gap: 2px;
        }
        
        .totals-row.amount-words .label {
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .totals-row.amount-words .value {
            font-size: 8pt;
            font-style: italic;
            color: var(--tus-black);
        }
        
        /* === SIGNATURE === */
        .signature-section {
            display: flex;
            gap: 15px;
            padding: 10px 30px;
        }
        
        .signature-box {
            flex: 1;
            border: 1px dashed var(--tus-light);
            border-radius: 8px;
            padding: 12px;
            min-height: 60px;
            text-align: center;
        }
        
        .signature-box h4 {
            font-size: 8pt;
            font-weight: 600;
            color: var(--tus-black);
            margin-bottom: 4px;
        }
        
        .signature-box p {
            font-size: 7pt;
            color: var(--tus-gray);
        }
        
        /* === CONDITIONS === */
        .conditions-section {
            padding: 8px 30px;
        }
        
        .conditions-box {
            background: var(--tus-white);
            border-radius: 6px;
            padding: 10px 12px;
            border-left: 3px solid var(--tus-blue);
        }
        
        .conditions-box h4 {
            font-size: 8pt;
            font-weight: 600;
            color: var(--tus-black);
            margin-bottom: 4px;
        }
        
        .conditions-box p {
            font-size: 7pt;
            color: var(--tus-gray);
            line-height: 1.5;
        }
        
        /* === FOOTER === */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--tus-gray-dark);
            border-top: 3px solid var(--tus-green);
        }
        
        .footer-content {
            display: flex;
            padding: 12px 30px;
            gap: 20px;
            font-size: 7pt;
        }
        
        .footer-brand {
            flex: 0 0 auto;
        }
        
        .footer-brand .name {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: white;
            font-size: 10pt;
        }
        
        .footer-brand .tagline {
            font-size: 6pt;
            color: var(--tus-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .footer-info {
            flex: 1;
            display: flex;
            gap: 25px;
            color: var(--tus-light);
        }
        
        .footer-col h5 {
            font-size: 6pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--tus-green);
            margin-bottom: 3px;
        }
        
        .footer-col p { line-height: 1.5; }
        
        .footer-col .highlight {
            color: white;
            font-weight: 500;
        }
        
        .footer-legal {
            text-align: right;
            color: var(--tus-light);
        }
        
        .footer-legal .label {
            color: var(--tus-green);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- HEADER -->
        <div class="header">
            <div class="brand-logo">
                <svg viewBox="0 0 520 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Trait d'Union Studio">
                    <defs>
                        <linearGradient id="tusGradNav" x1="0" y1="0" x2="260" y2="0" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#0B2DFF"/>
                            <stop offset="0.62" stop-color="#2D5BFF"/>
                            <stop offset="1" stop-color="#F6F7FB"/>
                        </linearGradient>
                    </defs>
                    <text x="0" y="54" font-family="Space Grotesk, Arial, sans-serif" font-size="44" font-weight="700" letter-spacing="1.1" fill="#F6F7FB">TRAIT D'UNION</text>
                    <rect x="0" y="69" width="240" height="6" rx="3" fill="url(#tusGradNav)"/>
                    <text x="0" y="106" font-family="Space Grotesk, Arial, sans-serif" font-size="22" font-weight="600" letter-spacing="4" fill="rgba(246,247,251,0.82)">STUDIO</text>
                </svg>
            </div>
            <div class="doc-header">
                <div class="doc-type">DEVIS</div>
                <div class="doc-number">{{ quote.number }}</div>
            </div>
        </div>
        
        <!-- META SECTION -->
        <div class="meta-section">
            <div class="meta-info">
                <div class="meta-item">
                    <span class="label">Date d'émission</span>
                    <strong>{{ quote.issue_date|date:"d/m/Y" }}</strong>
                </div>
                <div class="meta-item">
                    <span class="label">Validité</span>
                    <strong>30 jours</strong>
                </div>
                {% if quote.valid_until %}
                <div class="meta-item">
                    <span class="label">Expire le</span>
                    <strong>{{ quote.valid_until|date:"d/m/Y" }}</strong>
                </div>
                {% endif %}
            </div>
            <div class="total-badge">
                <div class="label">Total TTC</div>
                <div class="amount">{{ quote.total_ttc|floatformat:2 }} €</div>
            </div>
        </div>
        
        <!-- PARTIES -->
        <div class="parties">
            <div class="party emitter">
                <div class="party-label">Émetteur</div>
                <div class="party-name">{{ branding.name }}</div>
                <div class="party-tagline">{{ branding.tagline }}</div>
                <div class="party-details">
                    {{ branding.address }}<br>
                    {{ branding.zip_code }} {{ branding.city }}, {{ branding.region }}<br>
                    {{ branding.phone }}<br>
                    {{ branding.email }}
                </div>
            </div>
            
            <div class="party client">
                <div class="party-label">Destinataire</div>
                <div class="party-name">{% if quote.client.company %}{{ quote.client.company }}{% else %}{{ quote.client.full_name }}{% endif %}</div>
                <div class="party-details">
                    {% if quote.client.company and quote.client.full_name %}{{ quote.client.full_name }}<br>{% endif %}
                    {% if quote.client.address_line %}{{ quote.client.address_line }}<br>{% endif %}
                    {% if quote.client.zip_code or quote.client.city %}{{ quote.client.zip_code }} {{ quote.client.city }}<br>{% endif %}
                    {{ quote.client.email }}{% if quote.client.phone %}<br>{{ quote.client.phone }}{% endif %}
                </div>
            </div>
        </div>
        
        <!-- ITEMS TABLE -->
        <div class="items-section">
            <table class="items-table">
                <thead>
                    <tr>
                        <th style="width: 45%;">Description</th>
                        <th class="center" style="width: 10%;">Qté</th>
                        <th class="right" style="width: 15%;">Prix unit. HT</th>
                        <th class="center" style="width: 10%;">TVA</th>
                        <th class="right" style="width: 20%;">Total TTC</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>
                            <div class="item-description">{{ item.description }}</div>
                        </td>
                        <td class="center">{{ item.quantity }}</td>
                        <td class="right amount-cell">{{ item.unit_price|floatformat:2 }} €</td>
                        <td class="center">{{ item.tax_rate|default:"20"|floatformat:2 }}%</td>
                        <td class="right amount-cell">{{ item.total_ttc|floatformat:2 }} €</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--tus-gray); padding: 20px;">
                            Aucun élément dans ce devis
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- TOTALS -->
        <div class="totals-section">
            <div class="totals-box">
                <div class="totals-row subtotal">
                    <span class="label">Sous-total HT</span>
                    <span class="value">{{ quote.total_ht|floatformat:2 }} €</span>
                </div>
                <div class="totals-row">
                    <span class="label">TVA (20%)</span>
                    <span class="value">{{ quote.tva|floatformat:2 }} €</span>
                </div>
                <div class="totals-row grand-total">
                    <span class="label">Total TTC</span>
                    <span class="value">{{ quote.total_ttc|floatformat:2 }} €</span>
                </div>
                <div class="totals-row amount-words">
                    <span class="label">Arrêté à la somme de :</span>
                    <span class="value">{{ total_lettres }}</span>
                </div>
            </div>
        </div>
        
        <!-- SIGNATURE -->
        <div class="signature-section">
            <div class="signature-box">
                <h4>Bon pour accord</h4>
                <p>Date et signature du client<br>précédées de "Lu et approuvé"</p>
            </div>
            <div class="signature-box">
                <h4>{{ branding.name }}</h4>
                <p>Signature de l'émetteur</p>
            </div>
        </div>
        
        <!-- CONDITIONS -->
        <div class="conditions-section">
            <div class="conditions-box">
                <h4>Conditions générales</h4>
                <p>
                    • Acompte de 30% à la commande, solde à la livraison • Pénalités de retard: 3× le taux d'intérêt légal • TVA non applicable, art. 293 B du CGI
                </p>
            </div>
        </div>
        
        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="name">{{ branding.name }}</div>
                    <div class="tagline">{{ branding.tagline }}</div>
                </div>
                
                <div class="footer-info">
                    <div class="footer-col">
                        <h5>Contact</h5>
                        <p>
                            {% if branding.address %}{{ branding.address }}<br>{% endif %}
                            {% if branding.zip_code or branding.city %}{{ branding.zip_code }} {{ branding.city }}<br>{% endif %}
                            {% if branding.phone %}{{ branding.phone }}{% endif %}
                        </p>
                    </div>
                    <div class="footer-col">
                        <h5>Légal</h5>
                        <p>
                            {% if branding.siret %}<span class="highlight">SIRET:</span> {{ branding.siret }}<br>{% endif %}
                            {% if branding.tva_intra %}<span class="highlight">TVA:</span> {{ branding.tva_intra }}{% endif %}
                        </p>
                    </div>
                    <div class="footer-col">
                        <h5>Banque</h5>
                        <p>
                            {% if branding.iban %}<span class="highlight">IBAN:</span> {{ branding.iban }}<br>{% endif %}
                            {% if branding.bic %}<span class="highlight">BIC:</span> {{ branding.bic }}{% endif %}
                        </p>
                    </div>
                </div>
                
                <div class="footer-legal">
                    <span class="label">N°</span> {{ quote.number }}<br>
                    Page 1/1
                </div>
            </div>
        </div>
    </div>
</body>
</html>
