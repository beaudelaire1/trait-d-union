{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">

    <!-- Favicon - Configuration complète pour SEO et navigateurs -->
    <link rel="icon" href="/favicon.ico" sizes="48x48">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}?v=3">
    <link rel="icon" type="image/svg+xml" href="{% static 'img/favicon.svg' %}?v=3">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}?v=3">
    <link rel="mask-icon" href="{% static 'img/favicon.svg' %}?v=3" color="#07080A">
    <link rel="manifest" href="{% static 'site.webmanifest' %}">
    <meta name="theme-color" content="#07080A">
    <meta name="msapplication-TileColor" content="#07080A">

    <!-- View Transitions API -->
    <meta name="view-transition" content="same-origin">
    <title>{% block title %}Trait d'Union Studio{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Studio d'architecture digitale en Guyane (Cayenne, Kourou, Saint-Laurent), Martinique et Guadeloupe.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}architecture digitale guyane, création site internet cayenne, site web guadeloupe, site web martinique, studio web, architecture web kourou{% endblock %}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- OpenGraph tags -->
    <meta property="og:title" content="{% block og_title %}Trait d'Union Studio - Architecture Digitale{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Studio d'architecture digitale en Guyane, Martinique et Guadeloupe.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/apple-touch-icon.png' %}{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="Trait d'Union Studio">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}Trait d'Union Studio - Architecture Digitale{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Studio d'architecture digitale.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{% static 'img/apple-touch-icon.png' %}{% endblock %}">
    
    <!-- Google Analytics (G4) avec consentement RGPD -->
    {% if not debug %}
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VNHN8BQGMJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // Configuration avec anonymisation IP et respect RGPD
        gtag('config', 'G-VNHN8BQGMJ', {
            'anonymize_ip': true,
            'cookie_flags': 'SameSite=None;Secure',
            'cookie_domain': 'traitdunion.it',
            'cookie_expires': 63072000  // 2 ans
        });
        
        // Événements custom pour tracking conversions
        function trackEvent(category, action, label) {
            gtag('event', action, {
                'event_category': category,
                'event_label': label
            });
        }
        
        // Tracking conversion contact
        if (window.location.pathname === '/contact/' && document.referrer.includes('traitdunion.it')) {
            gtag('event', 'page_view_contact_form');
        }
    </script>
    {% endif %}
    
    <!-- Schema.org JSON-LD Structured Data -->
    {% include 'partials/schema_org.html' %}
    <!-- Preload fonts for better LCP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tus-black': '#07080A',
                        'tus-white': '#F6F7FB',
                        'tus-blue': '#0B2DFF',
                        'tus-green': '#22C55E',
                        'tus-green-light': '#4ADE80',
                        'surface-dark': '#0D1016',
                        'stroke-dark': 'rgba(246,247,251,0.10)',
                    },
                    fontFamily: {
                        'display': ['Space Grotesk', 'system-ui', 'sans-serif'],
                        'body': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'slide-up': 'slideUp 0.8s ease-out forwards',
                        'slide-in-right': 'slideInRight 0.6s ease-out forwards',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                        'marquee': 'marquee 20s linear infinite',
                        'gradient-shift': 'gradientShift 3s ease-in-out infinite',
                        'text-scroll': 'textScroll 18s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { opacity: '0', transform: 'translateX(-20px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(11,45,255,0.3)' },
                            '50%': { boxShadow: '0 0 40px rgba(11,45,255,0.6)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0%)' },
                            '100%': { transform: 'translateX(-50%)' },
                        },
                        gradientShift: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                        textScroll: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        /* Fix pour les options de select sur fond sombre */
        select option {
            background-color: #07080A;
            color: #F6F7FB;
            padding: 12px;
        }
        select option:hover,
        select option:focus,
        select option:checked {
            background-color: #0B2DFF;
            color: #F6F7FB;
        }
        /* Fix pour les navigateurs WebKit */
        select::-webkit-scrollbar {
            width: 8px;
        }
        select::-webkit-scrollbar-track {
            background: #0D1016;
        }
        select::-webkit-scrollbar-thumb {
            background: rgba(11,45,255,0.5);
            border-radius: 4px;
        }
        
        /* ============================================
           VIEW TRANSITIONS - Apple-like smoothness
           ============================================ */
        @view-transition {
            navigation: auto;
        }
        
        /* Transition de la page entière */
        ::view-transition-old(root) {
            animation: fade-out 0.25s ease-out forwards;
        }
        ::view-transition-new(root) {
            animation: fade-in 0.35s ease-out forwards;
        }
        
        /* Transitions personnalisées pour le contenu principal */
        ::view-transition-old(main-content) {
            animation: slide-out-left 0.3s ease-in-out forwards;
        }
        ::view-transition-new(main-content) {
            animation: slide-in-right 0.3s ease-in-out forwards;
        }
        
        /* Navbar reste fixe pendant les transitions */
        ::view-transition-group(navbar) {
            animation: none;
        }
        
        @keyframes fade-out {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slide-out-left {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(-20px); }
        }
        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* ============================================
           MICRO-INTERACTIONS
           ============================================ */
        /* Boutons avec feedback tactile */
        .btn-primary {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(11, 45, 255, 0.4);
        }
        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* Links avec underline animé */
        .link-animated {
            position: relative;
        }
        .link-animated::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #0B2DFF, #00D4FF);
            transition: width 0.3s ease;
        }
        .link-animated:hover::after {
            width: 100%;
        }
        
        /* Cards avec effet de profondeur */
        .card-interactive {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-interactive:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* ============================================
           ACCESSIBILITÉ CLAVIER - WCAG 2.1 AA
           ============================================ */
        /* Focus visible moderne pour tous les éléments interactifs */
        a:focus-visible,
        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible,
        [tabindex]:focus-visible {
            outline: 3px solid #0B2DFF;
            outline-offset: 2px;
            border-radius: 6px;
            transition: outline 0.15s ease;
        }
        
        /* Focus réduit pour liens dans le texte */
        p a:focus-visible,
        li a:focus-visible {
            outline-width: 2px;
            outline-offset: 3px;
        }
        
        /* Focus premium pour boutons primaires */
        .btn-primary:focus-visible,
        button[type="submit"]:focus-visible {
            outline: 3px solid #00D4FF;
            outline-offset: 4px;
            box-shadow: 0 0 0 6px rgba(11, 45, 255, 0.15);
        }
        
        /* Focus pour inputs avec style cohérent */
        input[type="text"]:focus-visible,
        input[type="email"]:focus-visible,
        input[type="tel"]:focus-visible,
        input[type="password"]:focus-visible,
        textarea:focus-visible {
            outline: 2px solid #0B2DFF;
            outline-offset: 0;
            border-color: #0B2DFF;
            box-shadow: 0 0 0 3px rgba(11, 45, 255, 0.1);
        }
        
        /* Zones tactiles minimales 44x44px (WCAG 2.5.5) */
        button,
        a[role="button"],
        input[type="submit"],
        input[type="button"] {
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Exception pour icônes dans boutons (padding interne) */
        button > svg,
        a > svg {
            pointer-events: none;
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* ============================================
           LOADING STATES & FEEDBACK VISUEL
           ============================================ */
        /* Bouton en état de chargement */
        button[disabled],
        button[aria-busy="true"],
        .btn-loading {
            position: relative;
            color: transparent !important;
            pointer-events: none;
            opacity: 0.7;
        }
        
        /* Spinner de chargement */
        button[disabled]::after,
        button[aria-busy="true"]::after,
        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 3px solid rgba(246, 247, 251, 0.3);
            border-top-color: #F6F7FB;
            border-radius: 50%;
            animation: spinner 0.8s linear infinite;
        }
        
        @keyframes spinner {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* ============================================
           VALIDATION INLINE & MESSAGES
           ============================================ */
        /* Conteneur de messages (ajouté via JS) */
        .form-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInDown 0.3s ease-out;
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-message.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #4ade80;
        }
        
        .form-message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171;
        }
        
        .form-message.warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #fbbf24;
        }
        
        /* États de validation pour inputs */
        input.valid,
        textarea.valid,
        select.valid {
            border-color: #22c55e !important;
            background: rgba(34, 197, 94, 0.05);
        }
        
        input.invalid,
        textarea.invalid,
        select.invalid {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.05);
        }
        
        /* Icônes de validation (SVG inline) */
        .input-wrapper {
            position: relative;
        }
        
        .input-wrapper.has-success::after {
            content: '✓';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #22c55e;
            font-weight: bold;
            font-size: 18px;
        }
        
        .input-wrapper.has-error::after {
            content: '✕';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #ef4444;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Labels accessibles avec indicateur requis */
        label.required::after {
            content: ' *';
            color: #ef4444;
            font-weight: bold;
        }
        
        /* Helper text sous les inputs */
        .input-helper {
            font-size: 0.75rem;
            color: rgba(246, 247, 251, 0.5);
            margin-top: 4px;
            transition: color 0.2s ease;
        }
        
        input:focus + .input-helper,
        textarea:focus + .input-helper {
            color: rgba(11, 45, 255, 0.8);
        }
        
        /* Annonces pour lecteurs d'écran */
        .sr-only-announce {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, ::before, ::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            html {
                scroll-behavior: auto;
            }
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-tus-black text-tus-white font-body antialiased">
    {% include 'partials/navbar.html' %}
    <main class="min-h-screen main-view-transition">
        {% block content %}{% endblock %}
    </main>
    {% include 'partials/footer.html' %}
    <!-- Alpine.js for micro-interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- HTMX with View Transitions support -->
    <script src="https://unpkg.com/htmx.org@2.0.0"></script>
    <script>
        // ============================================
        // HTMX Configuration - Simplified
        // ============================================
        
        // Only enable boost for specific elements, not globally
        // This prevents issues with full page navigation
        
        // Loading indicator for HTMX requests
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            document.body.classList.add('htmx-request');
            const target = evt.detail.elt;
            if (target.tagName === 'A' || target.tagName === 'BUTTON') {
                target.style.opacity = '0.7';
                target.style.pointerEvents = 'none';
            }
        });
        
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            document.body.classList.remove('htmx-request');
            evt.detail.elt.style.opacity = '';
            evt.detail.elt.style.pointerEvents = '';
        });
        
        // ============================================
        // MICRO-INTERACTIONS
        // ============================================
        
        // Magnetic buttons effect (Apple-like)
        document.querySelectorAll('.btn-magnetic').forEach(btn => {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                btn.style.transform = `translate(${x * 0.1}px, ${y * 0.1}px)`;
            });
            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translate(0, 0)';
            });
        });
        
        // Smooth scroll to anchors
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // ============================================
        // APPLE-LIKE SCROLL REVEAL
        // ============================================
        const revealElements = document.querySelectorAll('.reveal, .reveal-scale, .reveal-left, .reveal-right');
        
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });

        revealElements.forEach(el => revealObserver.observe(el));

        // ============================================
        // NAVBAR SCROLL EFFECT
        // ============================================
        const navbar = document.getElementById('navbar');
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            
            if (currentScroll > 50) {
                navbar.classList.add('navbar-scrolled');
            } else {
                navbar.classList.remove('navbar-scrolled');
            }
            
            lastScroll = currentScroll;
        }, { passive: true });

        // ============================================
        // CUSTOM CURSOR (Desktop only)
        // ============================================
        if (window.matchMedia('(hover: hover)').matches) {
            const cursorDot = document.createElement('div');
            const cursorRing = document.createElement('div');
            cursorDot.className = 'cursor-dot';
            cursorRing.className = 'cursor-ring';
            document.body.appendChild(cursorDot);
            document.body.appendChild(cursorRing);

            let mouseX = 0, mouseY = 0;
            let ringX = 0, ringY = 0;

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                cursorDot.style.left = mouseX + 'px';
                cursorDot.style.top = mouseY + 'px';
            });

            // Smooth ring follow
            function animateRing() {
                ringX += (mouseX - ringX) * 0.15;
                ringY += (mouseY - ringY) * 0.15;
                cursorRing.style.left = ringX + 'px';
                cursorRing.style.top = ringY + 'px';
                requestAnimationFrame(animateRing);
            }
            animateRing();

            // Hover effect on interactive elements
            const hoverTargets = document.querySelectorAll('a, button, .card-premium, .bento-item, input, textarea, select');
            hoverTargets.forEach(el => {
                el.addEventListener('mouseenter', () => cursorRing.classList.add('hover'));
                el.addEventListener('mouseleave', () => cursorRing.classList.remove('hover'));
            });
        }

        // ============================================
        // BENTO CARD MOUSE GLOW EFFECT
        // ============================================
        document.querySelectorAll('.bento-item').forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                card.style.setProperty('--mouse-x', x + '%');
                card.style.setProperty('--mouse-y', y + '%');
            });
        });

        // ============================================
        // NUMBER COUNTER ANIMATION
        // ============================================
        const counters = document.querySelectorAll('.counter');
        const counterObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.dataset.counted) {
                    entry.target.dataset.counted = 'true';
                    const target = parseInt(entry.target.dataset.target);
                    const suffix = entry.target.dataset.suffix || '';
                    let current = 0;
                    const increment = target / 50;
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            entry.target.textContent = target + suffix;
                            clearInterval(timer);
                        } else {
                            entry.target.textContent = Math.floor(current) + suffix;
                        }
                    }, 30);
                }
            });
        }, { threshold: 0.5 });

        counters.forEach(c => counterObserver.observe(c));

        // ============================================
        // VALIDATION INLINE & ARIA LIVE ANNOUNCEMENTS
        // ============================================
        
        // Créer un conteneur d'annonces pour les lecteurs d'écran
        (function initializeAccessibility() {
            // Conteneur aria-live pour annonces dynamiques
            if (!document.getElementById('aria-announcer')) {
                const announcer = document.createElement('div');
                announcer.id = 'aria-announcer';
                announcer.className = 'sr-only-announce';
                announcer.setAttribute('aria-live', 'polite');
                announcer.setAttribute('aria-atomic', 'true');
                document.body.appendChild(announcer);
            }
            
            // Fonction d'annonce accessible
            window.announce = function(message, priority = 'polite') {
                const announcer = document.getElementById('aria-announcer');
                if (announcer) {
                    announcer.setAttribute('aria-live', priority);
                    announcer.textContent = '';
                    setTimeout(() => {
                        announcer.textContent = message;
                    }, 100);
                }
            };
            
            // Validation en temps réel pour les formulaires
            const forms = document.querySelectorAll('form:not(.no-validate)');
            forms.forEach(form => {
                // État de chargement lors de la soumission
                form.addEventListener('submit', function(e) {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn && !submitBtn.hasAttribute('data-no-loading')) {
                        submitBtn.setAttribute('disabled', 'true');
                        submitBtn.setAttribute('aria-busy', 'true');
                        const originalText = submitBtn.textContent;
                        submitBtn.dataset.originalText = originalText;
                        
                        // Annonce pour lecteurs d'écran
                        window.announce('Envoi en cours, veuillez patienter', 'assertive');
                        
                        // Restaurer après 30s maximum (sécurité)
                        setTimeout(() => {
                            if (submitBtn.hasAttribute('disabled')) {
                                submitBtn.removeAttribute('disabled');
                                submitBtn.removeAttribute('aria-busy');
                                submitBtn.textContent = submitBtn.dataset.originalText;
                            }
                        }, 30000);
                    }
                });
                
                // Validation des inputs en temps réel
                const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
                inputs.forEach(input => {
                    // Ajouter attribut aria-required
                    input.setAttribute('aria-required', 'true');
                    
                    // Valider au blur
                    input.addEventListener('blur', function() {
                        validateInput(this);
                    });
                    
                    // Valider pendant la saisie (debounced)
                    let timeout;
                    input.addEventListener('input', function() {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            if (this.value.length > 0) {
                                validateInput(this);
                            }
                        }, 500);
                    });
                });
            });
            
            // Fonction de validation d'input
            function validateInput(input) {
                const value = input.value.trim();
                const type = input.type;
                let isValid = true;
                let message = '';
                
                // Validation selon le type
                if (input.hasAttribute('required') && !value) {
                    isValid = false;
                    message = 'Ce champ est requis';
                } else if (type === 'email' && value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    isValid = emailRegex.test(value);
                    message = isValid ? 'Email valide' : 'Format email invalide';
                } else if (type === 'tel' && value) {
                    const telRegex = /^[\d\s\-\+\(\)]+$/;
                    isValid = telRegex.test(value);
                    message = isValid ? 'Numéro valide' : 'Format téléphone invalide';
                } else if (input.hasAttribute('minlength') && value) {
                    const minLength = parseInt(input.getAttribute('minlength'));
                    isValid = value.length >= minLength;
                    message = isValid ? 'Longueur suffisante' : `Minimum ${minLength} caractères`;
                } else if (value) {
                    isValid = true;
                    message = 'Champ valide';
                }
                
                // Appliquer les classes visuelles
                input.classList.remove('valid', 'invalid');
                if (value) {
                    input.classList.add(isValid ? 'valid' : 'invalid');
                    input.setAttribute('aria-invalid', !isValid);
                }
                
                // Wrapper parent pour icône
                const wrapper = input.closest('.input-wrapper');
                if (wrapper && value) {
                    wrapper.classList.remove('has-success', 'has-error');
                    wrapper.classList.add(isValid ? 'has-success' : 'has-error');
                }
                
                // Afficher message si erreur
                let messageEl = input.parentElement.querySelector('.form-message');
                if (!isValid && value) {
                    if (!messageEl) {
                        messageEl = document.createElement('div');
                        messageEl.className = 'form-message error';
                        messageEl.setAttribute('role', 'alert');
                        input.parentElement.appendChild(messageEl);
                    }
                    messageEl.innerHTML = `<span>⚠</span><span>${message}</span>`;
                    messageEl.classList.remove('success');
                    messageEl.classList.add('error');
                    
                    // Annonce pour lecteurs d'écran
                    window.announce(`Erreur : ${message}`, 'assertive');
                } else if (messageEl) {
                    messageEl.remove();
                }
                
                return isValid;
            }
            
            // Exposer la fonction globalement pour usage externe
            window.validateInput = validateInput;
        })();

        // ============================================
        // EMAIL OBFUSCATION (Anti-Spam Protection)
        // ============================================
        // Décode les emails encodés Base64 dans les liens .tus-email-link
        // Exécuté une seule fois au chargement de la page
        (function() {
            function decodeEmails() {
                const links = document.querySelectorAll('.tus-email-link[data-email]');
                links.forEach(link => {
                    try {
                        const encoded = link.getAttribute('data-email');
                        const decoded = atob(encoded); // Décodage Base64
                        const label = link.getAttribute('data-label') || 'Nous écrire';
                        link.href = 'mailto:' + decoded;
                        link.textContent = label;
                        link.removeAttribute('data-email'); // Nettoyer après utilisation
                    } catch (e) {
                        console.warn('⚠️ Erreur décodage email:', e);
                        link.textContent = 'Nous contacter';
                        link.href = '/contact/';
                    }
                });
            }
            
            // Exécuter immédiatement (déjà dans DOMContentLoaded via script parent)
            decodeEmails();
        })();
    </script>
    {% block extra_js %}{% endblock %}
    
    <!-- RGPD Cookie Consent Banner -->
    {% include 'partials/cookie_consent.html' %}
</body>
</html>
